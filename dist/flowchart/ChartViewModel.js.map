{"version":3,"sources":["../../src/flowchart/ChartViewModel.js"],"names":["ChartViewModel","chartViewModel","data","nodeID","i","nodes","length","node","id","Error","connectorIndex","findNode","Data","nodeDataModel","push","select","deselect","deltaX","deltaY","selectedNodes","getSelectedNodes","x","y","ctrlKey","toggleSelected","deselectAll","nodeIndex","indexOf","splice","newNodeViewModels","newNodeDataModels","deletedNodeIds","selected","selectionRect","width","height"],"mappings":"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","file":"ChartViewModel.js","sourcesContent":["//import {NodeViewModel} from './NodeViewModel';\r\n\r\n\r\n export class ChartViewModel{\r\n         constructor(chartViewModel){\r\n           this.data=chartViewModel;\r\n           //this.nodeviewmodel=new NodeViewModel(this.data.nodes);\r\n           //this.nodes = this.nodeviewmodel.createNodesViewModel(this.data.nodes);\r\n           //this.nodes=this.data.nodes;\r\n\r\n         }\r\n\r\n\t\t//\r\n\t\t// Find a specific node within the chart.\r\n\t\t//\r\n\t\tfindNode(nodeID) {\r\n\r\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\r\n\t\t\t\tvar node = this.nodes[i];\r\n\t\t\t\tif (node.data.id == nodeID) {\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthrow new Error(\"Failed to find node \" + nodeID);\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Find a specific input connector within the chart.\r\n\t\t//\r\n\t\tfindInputConnector(nodeID, connectorIndex) {\r\n\r\n\t\t\tvar node = this.findNode(nodeID);\r\n\r\n\t\t\tif (!node.Data || node.Data.length <= connectorIndex) {\r\n\t\t\t\tthrow new Error(\"Node \" + nodeID + \" has invalid input connectors.\");\r\n\t\t\t}\r\n\r\n\t\t\treturn node.Data[connectorIndex];\r\n\t\t};\r\n\r\n\r\n\t\t// Add a node to the view model.\r\n\t\t//\r\n\t\taddNode(nodeDataModel) {\r\n\t\t\tif (!this.data.nodes) {\r\n\t\t\t\tthis.data.nodes = [];\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\t\t\t// Update the data model.\r\n\t\t\t//\r\n\r\n\t\t\tthis.data.nodes.push(nodeDataModel);\r\n\r\n\t\t\t//\r\n\t\t\t// Update the view model.\r\n\t\t\t//\r\n\t\t\t//this.nodes.push(new NodeViewModel(nodeDataModel));\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// Select all nodes and connections in the chart.\r\n\t\t//\r\n\t\tselectAll() {\r\n\r\n\t\t\tvar nodes = this.nodes;\r\n\t\t\tfor (var i = 0; i < nodes.length; ++i) {\r\n\t\t\t\tvar node = nodes[i];\r\n\t\t\t\tnode.select();\r\n\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t//\r\n\t\t// Deselect all nodes and connections in the chart.\r\n\t\t//\r\n\t\tdeselectAll() {\r\n\r\n\t\t\tvar nodes = this.nodes;\r\n\t\t\tfor (var i = 0; i < nodes.length; ++i) {\r\n\t\t\t\tvar node = nodes[i];\r\n\t\t\t\tnode.deselect();\r\n\t\t\t}\r\n\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Update the location of the node and its connectors.\r\n\t\t//\r\n\t\tupdateSelectedNodesLocation(deltaX, deltaY) {\r\n\r\n\t\t\tvar selectedNodes = this.getSelectedNodes();\r\n\r\n\t\t\tfor (var i = 0; i < selectedNodes.length; ++i) {\r\n\t\t\t\tvar node = selectedNodes[i];\r\n\t\t\t\tnode.data.x += deltaX;\r\n\t\t\t\tnode.data.y += deltaY;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Handle mouse click on a particular node.\r\n\t\t//\r\n\t\thandleNodeClicked(node, ctrlKey) {\r\n\r\n\t\t\tif (ctrlKey) {\r\n\t\t\t\tnode.toggleSelected();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.deselectAll();\r\n\t\t\t\tnode.select();\r\n\t\t\t}\r\n\r\n\t\t\t// Move node to the end of the list so it is rendered after all the other.\r\n\t\t\t// This is the way Z-order is done in SVG.\r\n\r\n\t\t\tvar nodeIndex = this.nodes.indexOf(node);\r\n\t\t\tif (nodeIndex == -1) {\r\n\t\t\t\tthrow new Error(\"Failed to find node in view model!\");\r\n\t\t\t}\r\n\t\t\tthis.nodes.splice(nodeIndex, 1);\r\n\t\t\tthis.nodes.push(node);\r\n\t\t};\r\n\r\n\r\n\r\n\t\t//\r\n\t\t// Delete all nodes and connections that are selected.\r\n\t\t//\r\n\t\tdeleteSelected() {\r\n\r\n\t\t\tvar newNodeViewModels = [];\r\n\t\t\tvar newNodeDataModels = [];\r\n\r\n\t\t\tvar deletedNodeIds = [];\r\n\r\n\t\t\t//\r\n\t\t\t// Sort nodes into:\r\n\t\t\t//\t\tnodes to keep and\r\n\t\t\t//\t\tnodes to delete.\r\n\t\t\t//\r\n\r\n\t\t\tfor (var nodeIndex = 0; nodeIndex < this.nodes.length; ++nodeIndex) {\r\n\r\n\t\t\t\tvar node = this.nodes[nodeIndex];\r\n\t\t\t\tif (!node.selected()) {\r\n\t\t\t\t\t// Only retain non-selected nodes.\r\n\t\t\t\t\tnewNodeViewModels.push(node);\r\n\t\t\t\t\tnewNodeDataModels.push(node.data);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Keep track of nodes that were deleted, so their connections can also\r\n\t\t\t\t\t// be deleted.\r\n\t\t\t\t\tdeletedNodeIds.push(node.data.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\t//\r\n\t\t\t// Remove connections that are selected.\r\n\t\t\t// Also remove connections for nodes that have been deleted.\r\n\t\t\t//\r\n\r\n\r\n\t\t\t//\r\n\t\t\t// Update nodes and connections.\r\n\t\t\t//\r\n\t\t\tthis.nodes = newNodeViewModels;\r\n\t\t\tthis.data.nodes = newNodeDataModels;\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Select nodes and connections that fall within the selection rect.\r\n\t\t//\r\n\t\tapplySelectionRect(selectionRect) {\r\n\r\n\t\t\tthis.deselectAll();\r\n\r\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\r\n\t\t\t\tvar node = this.nodes[i];\r\n\t\t\t\tif (node.x() >= selectionRect.x &&\r\n\t\t\t\t\tnode.y() >= selectionRect.y &&\r\n\t\t\t\t\tnode.x() + node.width() <= selectionRect.x + selectionRect.width &&\r\n\t\t\t\t\tnode.y() + node.height() <= selectionRect.y + selectionRect.height)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Select nodes that are within the selection rect.\r\n\t\t\t\t\tnode.select();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Get the array of nodes that are currently selected.\r\n\t\t//\r\n\t\tgetSelectedNodes() {\r\n\t\t\tvar selectedNodes = [];\r\n\r\n\t\t\tfor (var i = 0; i < this.nodes.length; ++i) {\r\n\t\t\t\tvar node = this.nodes[i];\r\n\t\t\t\tif (node.selected()) {\r\n\t\t\t\t\tselectedNodes.push(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn selectedNodes;\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// Get the array of connections that are currently selected.\r\n\t\t//\r\n\r\n\r\n\r\n\t};"]}